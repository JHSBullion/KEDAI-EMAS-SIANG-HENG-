<!doctype html>
<html lang="zh">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin Login</title>
  <link rel="stylesheet" href="style.css" />
  <script type="module" src="supabase.js"></script>
</head>
<body>
  <!-- 顶栏 -->
  <div class="navbar">
    <div class="navbar-inner container">
      <div class="brand"><span class="crest"></span><span data-i18n="login_nav_title">KEDAI EMAS SIANG HENG 会员系统</span></div>
      <div class="actions">
        <a class="btn" href="index.html" data-i18n="back_home">返回首页</a>
        <div class="lang-pill">
          <select class="lang">
            <option value="zh">中</option><option value="en">EN</option><option value="ms">BM</option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <!-- 登录卡片 -->
  <div class="container" style="max-width:960px; margin: 18px auto;">
    <div class="card" style="margin-bottom:14px;">
      <h2 data-i18n="login_title">登录</h2>
      <form id="loginForm" style="display:grid; grid-template-columns:1fr 1fr auto; gap:10px; align-items:center; margin-top:12px;">
        <label for="email" id="emailLabel" data-i18n="login_email">邮箱</label>
        <input id="email" class="input" type="email" data-i18n-ph="phone_placeholder" placeholder="请输入邮箱">
        <label for="password" id="passwordLabel" data-i18n="login_password">密码</label>
        <input id="password" class="input" type="password" placeholder="******">
        <button class="btn btn-gold" type="submit" data-i18n="login_btn">登录</button>
      </form>
      <div id="msg" class="sub" style="color:#c00;margin-top:8px;"></div>
    </div>

    <div class="card">
      <h3 data-i18n="tips_title">提示</h3>
      <p id="tipsText" class="sub" data-i18n="tips_text">
        请使用 Supabase 管理员邮箱与密码登录（例如 admin@shop.com / 123456）。
      </p>
    </div>
  </div>

  <div class="footer">© 2025 KEDAI EMAS SIANG HENG · All rights reserved.</div>

  <script src="lang.js"></script>
  <script type="module">
    import { supabase } from './supabase.js'

    const f = document.getElementById('loginForm')
    const email = document.getElementById('email')
    const password = document.getElementById('password')
    const msg = document.getElementById('msg')

    f.addEventListener('submit', async (e)=>{
      e.preventDefault()
      msg.textContent = ''
      const em = email.value.trim()
      const pw = password.value
      if(!em || !pw){ msg.textContent = '请输入邮箱与密码 / Please enter email & password'; return }

      try{
        const { data, error } = await supabase.auth.signInWithPassword({ email: em, password: pw })
        if(error) { msg.textContent = error.message; return }
        // 登录成功，去后台首页（如需改目标，改这里）
        location.href = 'admin-members.html'
      }catch(err){
        msg.textContent = err.message || 'Login failed'
      }
    })
  </script>
</body>
</html>
