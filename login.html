
<!doctype html><html lang="zh">
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin Login</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://unpkg.com/@supabase/supabase-js@2.45.4/dist/umd/supabase.js"></script>
  <script src="lang.js"></script>
  <script src="app.js"></script>
  <script src="supabase.js"></script>
</head>
<body>
  <div id="nav"></div>
  <div class="container">
    <div class="card" style="max-width:760px;margin:auto">
      <div class="title" data-i18n="login">登录</div>
      <div class="grid">
        <label data-i18n="email">邮箱</label>
        <input id="email" class="input" placeholder="admin@shop.com" data-ph="email">
        <label data-i18n="password">密码</label>
        <input id="password" class="input" type="password" placeholder="******" data-ph="password">
        <div class="actions">
          <button class="btn gold" onclick="doLogin()" data-i18n="signIn">登录</button>
          <a class="btn" href="index.html" data-i18n="backHome">返回首页</a>
        </div>
        <div class="note" data-i18n="signInHint">请使用 Supabase 管理员邮箱/密码登录（如 admin@shop.com / 123456）。</div>
        <div id="loginMsg" class="note bad hidden"></div>
      </div>
    </div>
  </div>
  <div class="footer">© 2025 KEDAI EMAS SIANG HENG · All rights reserved.</div>

<script>
document.getElementById('nav').innerHTML = navbar();
bindLangSelect();

async function doLogin(){
  const email = document.getElementById('email').value.trim();
  const password = document.getElementById('password').value;
  const msg = document.getElementById('loginMsg');
  msg.classList.add('hidden'); msg.textContent='';

  // static admin first
  if (STATIC_ADMIN.enabled && email==='admin' && password==='123456'){
    localStorage.setItem('static_admin','1');
    location.href='admin-members.html';
    return;
  }
  try{
    const { data, error } = await sb.auth.signInWithPassword({ email, password });
    if(error){ msg.textContent = error.message; msg.classList.remove('hidden'); return; }
    location.href='admin-members.html';
  }catch(e){
    msg.textContent = e.message || 'Login failed';
    msg.classList.remove('hidden');
  }
}
</script>
</body></html>
