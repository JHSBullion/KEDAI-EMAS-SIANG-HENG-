<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Admin · Add Member · KEDAI EMAS SIANG HENG</title>
<link rel="icon" href="data:,">
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:#0f172a;color:#e5e7eb;margin:0;padding:24px}
  .card{max-width:820px;margin:0 auto;background:#111827;border:1px solid #1f2937;border-radius:14px;padding:20px}
  h1{margin:0 0 10px;font-size:22px}
  .row{display:flex;gap:12px;flex-wrap:wrap;margin:12px 0}
  input,button{height:40px;border-radius:10px;border:1px solid #374151;background:#0b1220;color:#e5e7eb;padding:0 12px;font-size:14px}
  input{flex:1;min-width:220px}
  button{cursor:pointer;background:#2563eb;border-color:#3b82f6}
  table{width:100%;border-collapse:collapse;margin-top:10px}
  th,td{border-bottom:1px solid #1f2937;padding:8px;text-align:left}
  .msg{min-height:24px}
  .nav a{color:#93c5fd;margin-right:10px;text-decoration:none}
</style>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const ADMIN_PASS="123456";
const SB = supabase.createClient("https://mnzwqqxybhjqrfzydwk.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1uendxcXh5YmhqcXJmcnp5ZHdrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY0NzgzMzIsImV4cCI6MjA3MjA1NDMzMn0.Yo27vsFqgVM9wWKRgI-ErV2Fl6kjsYcQQPqbe8nGZOQ");
const $ = s => document.querySelector(s);
const tip=(t,ok=true)=>{$('#msg').innerHTML=`<span style="color:${ok?'#34d399':'#f87171'}">${t}</span>`;setTimeout(()=>$('#msg').innerHTML='',2500);};

function gate(){ const p = prompt("Admin Password"); if(p!==ADMIN_PASS){ alert("Wrong password"); location.reload(); } }
document.addEventListener('DOMContentLoaded', gate);

async function addMember(){
  const name = $('#name').value.trim();
  const phone= $('#phone').value.trim();
  if(!name||!phone){ tip("Name & phone are required", false); return; }
  const { data:dup, error:e1 } = await SB.from('members').select('id').eq('phone', phone).limit(1);
  if(e1){ tip(e1.message,false); return; }
  if(dup?.length){ tip("Phone already exists", false); return; }
  const { error } = await SB.from('members').insert({ name, phone });
  if(error){ tip(error.message,false); return; }
  tip("Member added!");
  $('#name').value=''; $('#phone').value=''; load();
}

async function load(){
  const { data, error } = await SB.from('member_points').select('member_id,name,phone,points').order('points',{ascending:false});
  if(error){ tip(error.message,false); return; }
  $('#list tbody').innerHTML = (data||[]).map(r=>`<tr><td style="font-family:monospace">${r.member_id}</td><td>${r.name||''}</td><td>${r.phone||''}</td><td>${r.points??0}</td></tr>`).join('') || `<tr><td colspan="4" style="color:#9ca3af">No data</td></tr>`;
}
document.addEventListener('DOMContentLoaded', load);
</script>
</head>
<body>
<div class="card">
  <h1>Add Member · KEDAI EMAS SIANG HENG</h1>
  <div class="row">
    <input id="name" placeholder="Name (required)" />
    <input id="phone" placeholder="Phone (unique)" />
    <button onclick="addMember()">Add</button>
    <button onclick="load()">Refresh</button>
  </div>
  <div id="msg" class="msg"></div>

  <table id="list">
    <thead><tr><th>Member ID</th><th>Name</th><th>Phone</th><th>Points</th></tr></thead>
    <tbody></tbody>
  </table>

  <div class="nav" style="margin-top:10px">
    <a href="/index.html">Customer</a>
    <a href="/admin/points.html">Adjust Points</a>
  </div>
</div>
</body>
</html>
