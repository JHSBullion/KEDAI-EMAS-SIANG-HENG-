<!doctype html>
<html lang="zh">
<head>
  <meta charset="utf-8" />
  <title>会员积分查询</title>
  <link rel="stylesheet" href="style.css" />
  <script type="module" src="supabase.js"></script>
</head>
<body>
  <div class="navbar">
    <div class="container" style="display:flex;align-items:center;justify-content:space-between;gap:12px;height:60px;">
      <div class="brand"><span class="crest"></span><span>会员积分查询</span></div>
      <div class="nav-right">
        <a class="btn" href="index.html">首页</a>
        <a class="btn" href="login.html">管理员登入</a>
      </div>
    </div>
  </div>

  <div class="container" style="margin:30px auto;max-width:500px;">
    <div class="card">
      <h3 style="margin-bottom:10px;">请输入手机号查询积分</h3>
      <div class="form-row">
        <input id="phone" class="input" placeholder="输入手机号">
      </div>
      <button id="btnSearch" class="btn btn-gold" style="margin-top:10px;">查询</button>
      <div id="msg" class="alert mt-10" style="display:none"></div>

      <div id="result" style="display:none;margin-top:20px;">
        <h3>查询结果</h3>
        <p><strong>姓名：</strong><span id="name"></span></p>
        <p><strong>电话：</strong><span id="rphone"></span></p>
        <p><strong>总积分：</strong><span id="points"></span></p>
      </div>
    </div>
  </div>

  <div class="footer">© 2025 KEDAI EMAS SIANG HENG · All rights reserved.</div>

  <script type="module">
    import { supabase } from './supabase.js'
    const $ = s=>document.querySelector(s)
    const msg = $('#msg')
    const result = $('#result')

    function setMsg(text, ok=false){
      msg.className = 'alert ' + (ok ? 'alert-success':'alert-error')
      msg.textContent = text
      msg.style.display = 'block'
    }

    $('#btnSearch').addEventListener('click', async ()=>{
      msg.style.display='none'
      result.style.display='none'
      const phone = $('#phone').value.trim()

      if(!phone){
        setMsg('请输入手机号')
        return
      }

      const { data, error } = await supabase
        .from('members')
        .select('id, name, phone, total_points')
        .eq('phone', phone)
        .maybeSingle()

      if(error){
        console.error(error)
        setMsg(error.message || '查询出错')
        return
      }

      if(!data){
        setMsg('未找到该会员')
        return
      }

      // 显示结果
      $('#name').textContent = data.name || '-'
      $('#rphone').textContent = data.phone || '-'
      $('#points').textContent = data.total_points || 0
      result.style.display = 'block'
    })
  </script>
</body>
</html>
