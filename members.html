<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>会员搜索列表</title><link rel="icon" href="data:,">
<style>
:root{color-scheme:dark light}
body{margin:0;background:#0b1020;color:#e7e9ee;font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto}
.wrap{max-width:1000px;margin:56px auto;padding:0 18px}
.card{background:#0f172a;border:1px solid #1f2937;border-radius:16px;padding:20px;box-shadow:0 10px 40px rgba(0,0,0,.35)}
h1{font-size:20px;margin:0 0 14px}
.row{display:flex;gap:10px;flex-wrap:wrap;margin:10px 0}
input,button{height:44px;border-radius:10px;border:1px solid #344155;background:#0b1220;color:#e7e9ee;padding:0 12px}
input{flex:1;min-width:220px}
.primary{background:#2563eb;border-color:#3b82f6;cursor:pointer}
table{width:100%;border-collapse:collapse;margin-top:14px}
th,td{border-bottom:1px solid #1f2937;padding:10px 8px;text-align:left}
.brand{font-weight:700;color:#f5d58a}
.nav a{color:#93c5fd;margin-right:14px;text-decoration:none}
</style>
<script type="module">
import { api, tip } from './web.js'

async function search(){
  const q = document.querySelector('#q').value.trim()
  const msg = document.querySelector('#msg')
  if(!q){ tip(msg,'输入姓名或电话片段',false); return }
  try{
    const rows = await api('/.netlify/functions/search-members?q='+encodeURIComponent(q))
    document.querySelector('#list tbody').innerHTML = rows.map(r=>`
      <tr><td>${r.id}</td><td>${r.name}</td><td>${r.phone}</td><td>${new Date(r.created_at).toLocaleString()}</td></tr>
    `).join('') || '<tr><td colspan="4">无结果</td></tr>'
  }catch(e){ tip(msg,'搜索失败：'+e.message,false) }
}

window.addEventListener('DOMContentLoaded', ()=>{
  document.querySelector('#btn').addEventListener('click', search)
})
</script>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="brand">KEDAI EMAS SIANG HENG</div>
      <h1>会员搜索列表</h1>
      <div class="row">
        <input id="q" placeholder="输入姓名或电话关键词">
        <button id="btn" class="primary">搜索</button>
      </div>
      <div id="msg"></div>

      <table id="list">
        <thead><tr><th>Member ID</th><th>Name</th><th>Phone</th><th>Created</th></tr></thead>
        <tbody></tbody>
      </table>

      <div class="nav" style="margin-top:12px">
        <a href="index.html">Customer</a>
        <a href="add-member.html">Add Member</a>
        <a href="points.html">Adjust Points</a>
        <a href="qr.html">QR</a>
      </div>
    </div>
  </div>
</body>
</html>
