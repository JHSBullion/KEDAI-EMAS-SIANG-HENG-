<!doctype html>
<html lang="zh">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>会员积分 · KEDAI EMAS SIANG HENG</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- 顶栏 -->
  <div class="navbar">
    <div class="navbar-inner container">
      <div class="brand">
        <span class="crest"></span>
        <span data-i18n="brand_title">KEDAI EMAS SIANG HENG 会员系统</span>
      </div>
      <div class="actions">
        <a class="btn" href="index.html">返回首页</a>
      </div>
    </div>
  </div>

  <!-- 内容：查询结果 -->
  <section class="hero">
    <div class="container">
      <div class="wrap">
        <div class="card" style="max-width:680px;margin:0 auto">
          <h1 class="h1">查询结果</h1>
          <p id="resultDisplay">加载中...</p>
        </div>
      </div>
    </div>
  </section>

  <div class="footer">© 2025 KEDAI EMAS SIANG HENG · All rights reserved.</div>

  <!-- ✅ 积分查询逻辑 -->
  <script>
    function normalizePhone(p) {
      return (p || '').trim().replace(/\s+/g, '').replace(/[^\d]/g, '');
    }

    document.addEventListener("DOMContentLoaded", function() {
      const urlParams = new URLSearchParams(window.location.search);
      let phone = urlParams.get("phone");
      phone = normalizePhone(phone);

      if (phone) {
        fetchPoints(phone);
      } else {
        document.getElementById("resultDisplay").innerText = "未找到有效的手机号";
      }
    });

    // ✅ 查询积分
    async function fetchPoints(phone) {
      try {
        // ⚠️ 替换成你实际的 Supabase 查询
        // 例如：
        // const { data, error } = await supabase
        //   .from("members")
        //   .select("points")
        //   .eq("phone", phone);
        // if (error) throw error;

        // 模拟：假设数据库查到积分 200
        const data = [{ points: 200 }];

        if (data.length === 0) {
          document.getElementById("resultDisplay").innerText = "未找到该手机号的积分";
        } else {
          document.getElementById("resultDisplay").innerText = "积分: " + data[0].points;
        }
      } catch (err) {
        console.error("查询失败:", err);
        document.getElementById("resultDisplay").innerText = "查询失败，请稍后重试";
      }
    }
  </script>
</body>
</html>
